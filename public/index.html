<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>M·ªôt ch√∫t ng·ªçt ng√†o g·ª≠i ƒëi</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@500&display=swap" rel="stylesheet">

  <!-- External CSS -->
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <!-- Logo -->
  <img src="/logo.png" alt="RƒÉng Ng·ªçt Logo" class="logo">

  <!-- Sub text -->
  <p class="subtitle">M·ªôt ch√∫t ng·ªçt ng√†o g·ª≠i t·ªõi b·∫°n üíù</p>

  <!-- Upload card -->
  <div class="card">
    <h2>G·ª≠i l·ªùi ch√∫c c·ªßa b·∫°n</h2>
    <label for="audioFile" class="file-label">Ch·ªçn file √¢m thanh üéµ</label>
    <input type="file" id="audioFile" accept="audio/*" style="display:none;">
    <button class="upload-btn" id="uploadBtn">üì§ T·∫£i l·ªùi ch√∫c & t·∫°o link</button>

    <div id="result">
      <a id="receiverLink" href="#" target="_blank"></a>
      <div id="qrCanvas"></div>
    </div>
  </div>

  <!-- Hi·ªáu ·ª©ng tim bay -->
  <script>
    for (let i = 0; i < 15; i++) {
      const heart = document.createElement('div');
      heart.classList.add('heart');
      heart.style.left = Math.random() * 100 + 'vw';
      heart.style.animationDuration = 6 + Math.random() * 5 + 's';
      document.body.appendChild(heart);
    }
  </script>

  <!-- QRCodeJS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <!-- Upload Script -->
  <script>
    const uploadBtn = document.getElementById('uploadBtn');
    const fileInput = document.getElementById('audioFile');
    const resultBox = document.getElementById('result');
    const receiverLink = document.getElementById('receiverLink');
    const qrCanvas = document.getElementById('qrCanvas');

    uploadBtn.addEventListener('click', () => fileInput.click());

    fileInput.addEventListener('change', async () => {
      if (!fileInput.files.length) return;
      uploadBtn.disabled = true;
      uploadBtn.textContent = 'ƒêang x·ª≠ l√Ω...';

      const formData = new FormData();
      formData.append('audio', fileInput.files[0]);

      try {
        const response = await fetch('/upload', { method: 'POST', body: formData });
        const data = await response.json();

        if (data.success) {
          const fullURL = `${window.location.origin}${data.receiverUrl}`;
          receiverLink.textContent = fullURL;
          receiverLink.href = fullURL;

          qrCanvas.innerHTML = '';
          new QRCode(qrCanvas, {
            text: fullURL,
            width: 100,
            height: 100,
            colorDark: '#f4cde0',
            colorLight: '#fff7fa'
          });

          resultBox.style.display = 'block';
        } else alert('L·ªói khi upload file.');
      } catch (err) {
        console.error(err);
        alert('ƒê√£ x·∫£y ra l·ªói khi k·∫øt n·ªëi m√°y ch·ªß.');
      }

      uploadBtn.disabled = false;
      uploadBtn.textContent = 'üì§ T·∫£i l·ªùi ch√∫c & t·∫°o link';
    });
  </script>
</body>
</html>
